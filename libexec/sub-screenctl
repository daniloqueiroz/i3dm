#!/usr/bin/env bash
# Usage: i3dm screenctl
# Summary: change screen configuration
# Help: Configure xrandr detected screens

source ${libs_file}

cmd=${1:-udev}

if [ ${cmd} == udev ]; then
  log_i screen "udev monitor event received..."
  xrandr > /dev/null
  sleep 10s
elif [ ${cmd} == '--ui' ]; then
  lxrandr
fi

xrandr | grep "HDMI2 connected"
if [ $? -eq 0 ]; then
  log_i screen "HDMI monitor detected"
  notify Screen "HDMI monitor detected"
  xrandr --output eDP1 --auto --output HDMI2 --auto --right-of eDP1
else
  log_i screen "HDMI monitor not detected"
  notify Screen "HDMI monitor not detected"
  xrandr --output eDP1 --auto --output HDMI2 --off
fi

# Launch bar
# Terminate already running bar instances
killall -q polybar
# Wait until the processes have been shut down
while pgrep -x polybar >/dev/null; do sleep 1; done
# Bar is the name set in the polybar config, so if you change it, you have to change it here too.
polybar -c ${i3dm_polybar_conf} bar
notify Bar Polybar started
