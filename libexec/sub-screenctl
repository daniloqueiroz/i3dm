#!/usr/bin/env bash
# Usage: i3dm screenctl
# Summary: change screen configuration
# Help: Configure xrandr detected screens

set -x
source ${libs_file}

cmd=${1:-udev}

if [ ${cmd} == udev ]; then
  log_i screen "udev monitor event received..."
  mons > /dev/null
  sleep 10s
elif [ ${cmd} == '--ui' ]; then
  lxrandr
  exit
fi

mons_num=$(mons | grep Monitors | awk '{print $2}')
if [ ${mons_num} -gt 1 ]; then
  log_i screen "External monitor detected"
  notify Screen "External monitor detected"
  mons -e ${MON_SIDE}
else
  log_i screen "External monitor not detected"
  notify Screen "External monitor not detected"
  mons -o
fi

# Launch bar
# Terminate already running bar instances
killall -q polybar
# Wait until the processes have been shut down
while pgrep -x polybar >/dev/null; do sleep 1; done
# Bar is the name set in the polybar config, so if you change it, you have to change it here too.
polybar -c ${i3dm_polybar_conf} bar
notify Bar Polybar started


feh --bg-fill --randomize ${i3dm_wallpapers_dir}/*
